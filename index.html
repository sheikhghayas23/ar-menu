<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Spatial AR Dropper</title>

<style>
  :root { --accent: #00ffcc; }
  body { margin: 0; overflow: hidden; font-family: -apple-system, sans-serif; background: #000; }
  
  video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; }

  /* 3D World Scene */
  #scene-container {
    position: fixed;
    inset: 0;
    z-index: 2;
    perspective: 1200px;
    pointer-events: none;
  }

  #world {
    position: absolute;
    width: 100%; height: 100%;
    transform-style: preserve-3d;
    will-change: transform;
  }

  /* The actual food container */
  .anchor {
    position: absolute;
    left: 50%; top: 50%;
    transform-style: preserve-3d;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .dish-img {
    filter: drop-shadow(0 15px 25px rgba(0,0,0,0.6));
    animation: dropIn 0.4s ease-out;
    border-radius: 50%; /* Makes square images look like plates */
  }

  @keyframes dropIn {
    0% { transform: translateZ(-200px) scale(0); opacity: 0; }
    100% { transform: translateZ(0) scale(1); opacity: 1; }
  }

  /* Target Reticle */
  #reticle {
    position: fixed; left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    width: 30px; height: 30px;
    border: 2px solid white; border-radius: 50%;
    z-index: 5; pointer-events: none;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
  }
  #reticle::after { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: white; border-radius: 50%; transform: translate(-50%, -50%); }

  /* Bottom Menu */
  #ui {
    position: fixed; bottom: 0; width: 100%;
    background: linear-gradient(to top, rgba(0,0,0,1), transparent);
    z-index: 10; padding: 20px 0 40px;
  }

  .carousel { display: flex; gap: 15px; overflow-x: auto; padding: 0 20px; scrollbar-width: none; }
  .carousel::-webkit-scrollbar { display: none; }

  .card {
    min-width: 90px; padding: 15px;
    background: rgba(255,255,255,0.1); border-radius: 20px;
    backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2);
    color: white; text-align: center; font-weight: bold;
  }
  .card.active { background: var(--accent); color: black; border-color: white; }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>
<div id="reticle"></div>

<div id="scene-container">
  <div id="world"></div>
</div>

<div id="ui">
  <div class="carousel" id="menu"></div>
  <p style="color: white; text-align: center; font-size: 10px; margin-top: 20px; opacity: 0.7;">
    POINT AT A SPOT AND TAP TO DROP FOOD
  </p>
</div>

<script>
const foodList = [
  { name: 'Biryani', img: 'https://media.istockphoto.com/id/501150349/photo/chicken-biryani-11.jpg?s=612x612&w=0&k=20&c=w6mDnUx8MnH3rnP9bR0VfWRwrODcbTz-6U07o3Zrs4o=' },
  { name: 'Pizza', img: 'https://img.freepik.com/free-psd/delicious-pepperoni-pizza-culinary-delight_632498-24206.jpg?w=740' },
  { name: 'Burger', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=500' },
  { name: 'Tacos', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTD-CUOhD5WqTgJIVDIjg40XOWKg4cf0rc56w&s' }
];

let selectedFood = foodList[0];
const world = document.getElementById('world');
let gyro = { alpha: 0, beta: 0, gamma: 0 };

// 1. Get Camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(s => document.getElementById('camera').srcObject = s);

// 2. Build Menu
const menu = document.getElementById('menu');
foodList.forEach((item, i) => {
  const card = document.createElement('div');
  card.className = `card ${i === 0 ? 'active' : ''}`;
  card.innerHTML = `<div>${item.name}</div>`;
  card.onclick = (e) => {
    e.stopPropagation();
    document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
    card.classList.add('active');
    selectedFood = item;
  };
  menu.appendChild(card);
});

// 3. Track Phone Orientation (The 3D Room)
window.addEventListener('deviceorientation', (e) => {
  // Alpha = Compass, Beta = Tilt, Gamma = Roll
  gyro.alpha = e.alpha || 0;
  gyro.beta = e.beta || 0;
  gyro.gamma = e.gamma || 0;
  
  // We rotate the ENTIRE world opposite to our phone move
  // This makes the objects feel "stuck" in the room
  world.style.transform = `rotateX(${gyro.beta - 90}deg) rotateZ(${-gyro.alpha}deg)`;
});

// 4. Drop Dish in Space
window.addEventListener('click', (e) => {
  if (e.target.closest('#ui')) return;

  const anchor = document.createElement('div');
  anchor.className = 'anchor';

  // We save the CURRENT orientation so it stays in this spot
  const dropAlpha = gyro.alpha;
  const dropBeta = gyro.beta;

  // Position logic: 
  // We use Z-translate to put it "forward"
  // We use the recorded Alpha/Beta to "offset" its position in the world container
  const distance = 600; // How far in front of you the food appears
  
  // This math "un-rotates" the dish so it stays at the compass point you clicked
  anchor.style.transform = `rotateZ(${dropAlpha}deg) rotateX(${-(dropBeta - 90)}deg) translateZ(${distance}px)`;

  const img = document.createElement('img');
  img.src = selectedFood.img;
  img.className = 'dish-img';
  img.style.width = '200px';

  anchor.appendChild(img);
  world.appendChild(anchor);

  if(navigator.vibrate) navigator.vibrate(20);
});
</script>
</body>
</html>
