<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Ultimate Spatial AR Menu</title>

<style>
  :root { 
    --accent: #00ffcc; 
    --glass: rgba(10, 10, 10, 0.8);
    --gold: #ffd700;
  }

  body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: #000; color: white; touch-action: none; }
  
  video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; }

  /* 3D Engine */
  #viewport { position: fixed; inset: 0; z-index: 2; perspective: 1200px; pointer-events: none; }
  #world { position: absolute; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.1s ease-out; }

  .spatial-node {
    position: absolute; left: 50%; top: 50%;
    transform-style: preserve-3d;
    display: flex; flex-direction: column; align-items: center;
    pointer-events: auto;
  }

  /* Food Styling */
  .food-container { position: relative; transform-style: preserve-3d; }
  
  .food-img {
    width: 260px; height: 260px; object-fit: cover;
    border-radius: 50%; border: 8px solid white;
    box-shadow: 0 30px 60px rgba(0,0,0,0.8);
    animation: dropIn 0.6s cubic-bezier(0.2, 1, 0.3, 1);
  }

  /* Steam Animation */
  .steam-wrap {
    position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 15px; pointer-events: none;
  }
  .steam-particle {
    width: 20px; height: 20px; background: rgba(255,255,255,0.4);
    filter: blur(10px); border-radius: 50%;
    animation: steamUp 2s infinite ease-out; opacity: 0;
  }
  .steam-particle:nth-child(2) { animation-delay: 0.5s; }
  .steam-particle:nth-child(3) { animation-delay: 1.2s; }

  @keyframes steamUp {
    0% { transform: translateY(0) scale(1); opacity: 0; }
    50% { opacity: 0.6; }
    100% { transform: translateY(-100px) scale(3); opacity: 0; }
  }

  /* Ground Shadow */
  .shadow {
    width: 200px; height: 40px;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.6) 0%, transparent 80%);
    transform: rotateX(90deg) translateZ(-130px);
    margin-top: -20px;
  }

  @keyframes dropIn {
    0% { transform: scale(0) rotateY(-180deg); opacity: 0; }
    100% { transform: scale(1) rotateY(0deg); opacity: 1; }
  }

  /* UI Header */
  .header {
    position: fixed; top: 0; width: 100%; z-index: 20;
    padding: 20px; display: flex; justify-content: space-between; align-items: center;
    background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
  }

  .cart-pill {
    background: var(--accent); color: black; padding: 10px 20px;
    border-radius: 30px; font-weight: 800; display: flex; gap: 10px;
    box-shadow: 0 10px 20px rgba(0,255,204,0.3);
  }

  /* UI Bottom Panel */
  #ui {
    position: fixed; bottom: 0; width: 100%; z-index: 20;
    background: linear-gradient(to top, #000 85%, transparent);
    padding: 20px 0 calc(30px + env(safe-area-inset-bottom));
  }

  .carousel { display: flex; gap: 15px; overflow-x: auto; padding: 0 20px; scrollbar-width: none; }
  .carousel::-webkit-scrollbar { display: none; }

  .card {
    min-width: 110px; background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 24px;
    padding: 15px; text-align: center; transition: 0.4s;
    backdrop-filter: blur(15px);
  }
  .card.active { border-color: var(--accent); background: rgba(0,255,204,0.15); transform: translateY(-10px); }
  .card img { width: 60px; height: 60px; border-radius: 50%; margin-bottom: 8px; }

  #reset-btn { background: #ff4444; border: none; color: white; padding: 12px; border-radius: 15px; font-weight: bold; }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<div class="header">
  <button id="reset-btn" onclick="clearAll()">Clear Room</button>
  <div class="cart-pill">
    <span>ðŸ›’</span> <span id="cart-count">0 Items</span>
  </div>
</div>

<div id="reticle"></div>

<div id="viewport">
  <div id="world"></div>
</div>

<div id="ui">
  <div class="category-bar" id="catBar" style="display:flex; gap:10px; overflow-x:auto; padding:0 20px 15px; scrollbar-width:none;"></div>
  <div class="carousel" id="menu"></div>
  <p style="text-align:center; font-size:11px; color:var(--accent); margin-top:15px; opacity:0.8; letter-spacing:1px;">TAP ANYWHERE TO PLACE ON TABLE</p>
</div>

<script>
// Logic for your 48 dishes (shortened for code space, keep your original full list)
const categories = [
  { name: "Desi", icon: "ðŸ›", items: [
      { name: 'Biryani', img: 'https://media.istockphoto.com/id/501150349/photo/chicken-biryani-11.jpg?s=612x612&w=0&k=20&c=w6mDnUx8MnH3rnP9bR0VfWRwrODcbTz-6U07o3Zrs4o=' },
      { name: 'Butter Chicken', img: 'https://images.unsplash.com/photo-1603894584115-f73f2ecb4f08?w=500' }
  ]},
  { name: "Italian", icon: "ðŸ•", items: [
      { name: 'Pizza', img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=500' },
      { name: 'Lasagna', img: 'https://images.unsplash.com/photo-1551183053-bf91a1d81141?w=500' }
  ]}
  // ... Add all your other categories here as per your list
];

let selectedItem = categories[0].items[0];
let curA = 0, curB = 0;
let placedNodes = [];
let cartCount = 0;
const world = document.getElementById('world');

// Camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(s => document.getElementById('camera').srcObject = s);

// Build UI
function initUI() {
  const bar = document.getElementById('catBar');
  categories.forEach((cat, i) => {
    const btn = document.createElement('div');
    btn.style = "padding:8px 16px; background:rgba(255,255,255,0.1); border-radius:20px; white-space:nowrap; font-size:12px;";
    btn.innerHTML = `${cat.icon} ${cat.name}`;
    btn.onclick = () => {
      document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
      buildMenu(cat);
    };
    bar.appendChild(btn);
  });
  buildMenu(categories[0]);
}

function buildMenu(cat) {
  const menu = document.getElementById('menu');
  menu.innerHTML = '';
  cat.items.forEach(item => {
    const c = document.createElement('div');
    c.className = 'card';
    c.innerHTML = `<img src="${item.img}"><div style="font-size:11px; font-weight:700;">${item.name}</div>`;
    c.onclick = (e) => {
      e.stopPropagation();
      document.querySelectorAll('.card').forEach(x => x.style.borderColor = 'transparent');
      c.style.borderColor = 'var(--accent)';
      selectedItem = item;
    };
    menu.appendChild(c);
  });
}

// 3D Motion Logic
window.addEventListener('deviceorientation', (e) => {
  curA = e.alpha || 0;
  curB = e.beta || 0;
  // This is the core AR pinning math
  world.style.transform = `rotateX(${curB - 90}deg) rotateZ(${-curA}deg)`;
});

// Drop Dish
window.addEventListener('click', (e) => {
  if (e.target.closest('#ui') || e.target.closest('.header')) return;

  const node = document.createElement('div');
  node.className = 'spatial-node';

  // 360Â° Sphere placement math
  let targetA = curA;
  let targetB = curB;
  let distance = 900;

  // Anti-Overlap Nudge
  placedNodes.forEach(p => {
    if (Math.abs(p.a - targetA) < 15 && Math.abs(p.b - targetB) < 15) {
      targetA += 20; 
    }
  });
  placedNodes.push({a: targetA, b: targetB});

  // Apply 3D position
  node.style.transform = `rotateZ(${targetA}deg) rotateX(${-targetB + 90}deg) translateZ(${distance}px)`;

  node.innerHTML = `
    <div class="food-container">
      <div class="steam-wrap">
        <div class="steam-particle"></div>
        <div class="steam-particle"></div>
        <div class="steam-particle"></div>
      </div>
      <img src="${selectedItem.img}" class="food-img">
      <div style="background:var(--glass); padding:8px 15px; border-radius:20px; margin-top:15px; font-weight:bold; border:1px solid var(--accent);">
        ${selectedItem.name}
      </div>
      <div class="shadow"></div>
    </div>
  `;

  world.appendChild(node);
  
  // Update Cart
  cartCount++;
  document.getElementById('cart-count').innerText = `${cartCount} Items`;
  if(navigator.vibrate) navigator.vibrate([20, 50, 20]);
});

function clearAll() {
  world.innerHTML = '';
  placedNodes = [];
  cartCount = 0;
  document.getElementById('cart-count').innerText = `0 Items`;
}

initUI();
</script>
</body>
</html>
