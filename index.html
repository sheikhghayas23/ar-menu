<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Ultimate AR Spatial Menu - Pro Edition</title>

<style>
  :root { 
    --accent: #00ffcc; 
    --glass: rgba(0,0,0,0.85);
    --warning: #ff4444;
  }

  body { margin: 0; overflow: hidden; font-family: -apple-system, sans-serif; background: #000; color: #fff; user-select: none; }
  
  video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; }

  /* 3D Scene Setup */
  #viewport { position: fixed; inset: 0; z-index: 2; perspective: 1200px; pointer-events: none; }
  #world { position: absolute; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.1s ease-out; }

  .spatial-node {
    position: absolute; left: 50%; top: 50%;
    transform-style: preserve-3d;
    display: flex; flex-direction: column; align-items: center;
    pointer-events: auto; /* Allows clicking individual dishes */
  }

  /* The Dish Styling */
  .dish-wrapper { 
    position: relative; 
    transform-style: preserve-3d; 
    transform: rotateX(-25deg); /* Professional tilt for table-view */
    cursor: pointer;
  }

  .food-img {
    width: 260px; height: 260px; object-fit: cover;
    border-radius: 50%; border: 8px solid #fff;
    box-shadow: 0 30px 80px rgba(0,0,0,0.8);
    animation: dropIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), dishGlow 3s infinite alternate;
  }

  @keyframes dishGlow {
    from { filter: brightness(1) drop-shadow(0 0 5px var(--accent)); }
    to { filter: brightness(1.1) drop-shadow(0 0 25px var(--accent)); }
  }

  /* Realistic Contact Shadow on "Floor" */
  .contact-shadow {
    position: absolute; width: 220px; height: 40px;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.7) 0%, transparent 80%);
    transform: rotateX(90deg) translateZ(-140px);
    z-index: -1;
  }

  /* STEAM SYSTEM */
  .steam-container {
    position: absolute; top: -50px; left: 50%;
    transform: translateX(-50%); width: 100px; height: 120px;
    pointer-events: none;
  }
  .steam-cloud {
    position: absolute; bottom: 0; left: 50%; width: 35px; height: 35px;
    background: rgba(255, 255, 255, 0.3); filter: blur(12px); border-radius: 50%;
    animation: steamRise 2s infinite ease-out; opacity: 0;
  }
  .steam-cloud:nth-child(2) { animation-delay: 0.6s; left: 40%; }
  .steam-cloud:nth-child(3) { animation-delay: 1.2s; left: 60%; }

  @keyframes steamRise {
    0% { transform: translateY(0) scale(1); opacity: 0; }
    30% { opacity: 0.5; }
    100% { transform: translateY(-100px) scale(4); opacity: 0; }
  }

  /* UI Header & Bottom */
  .header {
    position: fixed; top: 20px; width: 90%; left: 5%;
    display: flex; justify-content: space-between; align-items: center; z-index: 100;
  }
  .bill-pill { 
    background: var(--accent); color: #000; padding: 12px 24px;
    border-radius: 50px; font-weight: 900; box-shadow: 0 10px 20px rgba(0,255,204,0.3);
  }
  #reset-btn { background: var(--warning); color: #fff; border: none; padding: 12px 20px; border-radius: 15px; font-weight: bold; }

  #ui {
    position: fixed; bottom: 0; width: 100%; z-index: 10;
    background: linear-gradient(to top, #000 85%, transparent);
    padding: 20px 0 40px;
  }

  .carousel { display: flex; gap: 15px; overflow-x: auto; padding: 0 20px; scrollbar-width: none; }
  .carousel::-webkit-scrollbar { display: none; }

  .card {
    min-width: 110px; padding: 15px; background: var(--glass);
    border: 1px solid rgba(255,255,255,0.1); border-radius: 24px;
    text-align: center; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
  }
  .card.active { border-color: var(--accent); transform: translateY(-10px); background: rgba(0,255,204,0.1); }

  .label-3d {
    background: var(--glass); padding: 6px 16px; border-radius: 20px;
    margin-top: 15px; border: 1px solid var(--accent); font-size: 14px; font-weight: bold;
    animation: float 3s infinite ease-in-out;
  }

  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
  @keyframes dropIn { 0% { transform: scale(0) translateZ(-200px); } 100% { transform: scale(1) translateZ(0); } }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>

<div class="header">
  <button id="reset-btn" onclick="clearSpace()">CLEAR ALL</button>
  <div class="bill-pill">Total: $<span id="total-price">0</span></div>
</div>

<div id="viewport">
  <div id="world"></div>
</div>

<div id="ui">
  <div class="carousel" id="menu"></div>
  <p style="text-align:center; font-size:11px; color:var(--accent); margin-top:15px; letter-spacing:1px;">TAP TO SERVE â€¢ TAP DISH TO EAT (REMOVE)</p>
</div>

<script>
const items = [
  { name: 'Biryani', price: 15, img: 'https://media.istockphoto.com/id/501150349/photo/chicken-biryani-11.jpg?s=612x612&w=0&k=20&c=w6mDnUx8MnH3rnP9bR0VfWRwrODcbTz-6U07o3Zrs4o=' },
  { name: 'Pizza', price: 12, img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=500' },
  { name: 'Butter Chicken', price: 18, img: 'https://images.unsplash.com/photo-1603894584115-f73f2ecb4f08?w=500' },
  { name: 'Sushi', price: 22, img: 'https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=500' },
  { name: 'Burger', price: 10, img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=500' }
];

let selected = items[0];
let total = 0;
let curA = 0, curB = 0;
let placedNodes = [];
const world = document.getElementById('world');

// Camera Setup
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(s => document.getElementById('camera').srcObject = s);

// Build UI Menu
const menuCont = document.getElementById('menu');
items.forEach((item, i) => {
  const c = document.createElement('div');
  c.className = `card ${i===0?'active':''}`;
  c.innerHTML = `<div style="font-size:13px; font-weight:800;">${item.name}</div><div style="color:var(--accent); font-size:12px;">$${item.price}</div>`;
  c.onclick = (e) => {
    e.stopPropagation();
    document.querySelectorAll('.card').forEach(x => x.classList.remove('active'));
    c.classList.add('active');
    selected = item;
  };
  menuCont.appendChild(c);
});

// Sensor Tracking
window.addEventListener('deviceorientation', (e) => {
  curA = e.alpha || 0;
  curB = e.beta || 0;
  world.style.transform = `rotateX(${curB - 90}deg) rotateZ(${-curA}deg)`;
});

// Place / Serve Food
window.addEventListener('click', (e) => {
  if (e.target.closest('#ui') || e.target.closest('.header') || e.target.closest('.dish-wrapper')) return;

  let targetA = curA;
  let targetB = curB;

  // Spatial Anti-Overlap
  placedNodes.forEach(p => {
    if (Math.abs(p.a - targetA) < 15) { targetA += 22; }
  });
  placedNodes.push({a: targetA, b: targetB});

  const node = document.createElement('div');
  node.className = 'spatial-node';
  // Standard distance of 850px for depth
  node.style.transform = `rotateZ(${targetA}deg) rotateX(${-targetB + 90}deg) translateZ(850px)`;

  // Create the "Wonderful" Dish
  node.innerHTML = `
    <div class="dish-wrapper" onclick="removeDish(this, ${selected.price})">
      <div class="steam-container">
        <div class="steam-cloud"></div>
        <div class="steam-cloud"></div>
        <div class="steam-cloud"></div>
      </div>
      <img src="${selected.img}" class="food-img">
      <div class="label-3d">${selected.name}</div>
      <div class="contact-shadow"></div>
    </div>
  `;

  world.appendChild(node);
  updateTotal(selected.price);
  if(navigator.vibrate) navigator.vibrate([30, 10, 30]);
});

function removeDish(el, price) {
  el.parentElement.remove();
  updateTotal(-price);
}

function updateTotal(amount) {
  total += amount;
  document.getElementById('total-price').innerText = Math.max(0, total);
}

function clearSpace() {
  world.innerHTML = '';
  placedNodes = [];
  total = 0;
  document.getElementById('total-price').innerText = total;
}
</script>
</body>
</html>
