<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Spatial AR Pro - No Overlap</title>

<style>
  :root { --accent: #00ffcc; --glass: rgba(15, 15, 15, 0.9); }
  body { margin: 0; overflow: hidden; font-family: -apple-system, system-ui; background: #000; color: white; }
  
  video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; }

  /* 3D Scene Container */
  #viewport {
    position: fixed;
    inset: 0;
    z-index: 2;
    perspective: 1000px;
    overflow: hidden;
  }

  #ar-world {
    position: absolute;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
  }

  .spatial-node {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-style: preserve-3d;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .placed-dish {
    filter: drop-shadow(0 20px 30px rgba(0,0,0,0.8));
    animation: spawn 0.5s cubic-bezier(0.17, 0.88, 0.32, 1.28);
  }

  .dish-shadow {
    width: 160px; height: 40px;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0.6) 0%, transparent 80%);
    transform: rotateX(90deg) translateZ(-20px);
    margin-top: -20px;
  }

  @keyframes spawn {
    from { opacity: 0; transform: scale(0.5) translateZ(-100px); }
    to { opacity: 1; transform: scale(1) translateZ(0); }
  }

  #reticle {
    position: fixed; left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    width: 30px; height: 30px;
    border: 2px solid white; border-radius: 50%;
    z-index: 5; pointer-events: none;
  }

  #ui-bottom {
    position: fixed; bottom: 0; width: 100%;
    background: linear-gradient(to top, black, transparent);
    z-index: 10; padding: 20px 0 40px;
  }

  .carousel { display: flex; gap: 12px; overflow-x: auto; padding: 0 20px; scrollbar-width: none; }
  .carousel::-webkit-scrollbar { display: none; }

  .food-card {
    min-width: 90px; padding: 12px;
    background: var(--glass); border-radius: 15px;
    border: 1px solid rgba(255,255,255,0.1);
    text-align: center; transition: 0.3s;
  }
  .food-card.active { border-color: var(--accent); transform: scale(1.05); }

  #controls { padding: 15px 20px; display: flex; align-items: center; gap: 10px; font-size: 10px; }
  input[type=range] { flex: 1; accent-color: var(--accent); }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>
<div id="reticle"></div>

<div id="viewport">
  <div id="ar-world"></div>
</div>

<div id="ui-bottom">
  <div id="controls">
    <span>SCALE</span>
    <input type="range" id="sizeSlider" min="120" max="350" value="200">
  </div>
  <div class="carousel" id="menu"></div>
</div>

<script>
const items = [
  { name: 'Biryani', img: 'https://media.istockphoto.com/id/501150349/photo/chicken-biryani-11.jpg?s=612x612&w=0&k=20&c=w6mDnUx8MnH3rnP9bR0VfWRwrODcbTz-6U07o3Zrs4o=' },
  { name: 'Pizza', img: 'https://img.freepik.com/free-psd/delicious-pepperoni-pizza-culinary-delight_632498-24206.jpg?w=740' },
  { name: 'Taco', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTD-CUOhD5WqTgJIVDIjg40XOWKg4cf0rc56w&s' },
  { name: 'Korma', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT0bXMJFe78VrtqCkakaMrEBLMZ1_TskQUf-g&s' }
];

let selected = items[0];
let currentBeta = 0, currentGamma = 0;
const world = document.getElementById('ar-world');

// Camera Init
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(s => document.getElementById('camera').srcObject = s);

// Build UI
const menu = document.getElementById('menu');
items.forEach(item => {
  const card = document.createElement('div');
  card.className = 'food-card';
  card.innerHTML = `<div>${item.name}</div>`;
  card.onclick = (e) => {
    e.stopPropagation();
    document.querySelectorAll('.food-card').forEach(c => c.classList.remove('active'));
    card.classList.add('active');
    selected = item;
  };
  menu.appendChild(card);
});
document.querySelector('.food-card').classList.add('active');

// The Secret Sauce: Gyroscope tracking
window.addEventListener('deviceorientation', (e) => {
  currentBeta = e.beta; // Forward/Back tilt
  currentGamma = e.gamma; // Left/Right tilt
  
  // Inverse the world so it feels static
  world.style.transform = `rotateX(${-currentBeta}deg) rotateY(${-currentGamma}deg)`;
});

// Spatial Placement Logic
window.addEventListener('click', (e) => {
  if (e.target.closest('#ui-bottom')) return;

  const node = document.createElement('div');
  node.className = 'spatial-node';

  // We lock the node to the CURRENT orientation of the phone
  // By using the inverse of the current tilt, it stays at that "compass" point
  const xRotation = currentBeta;
  const yRotation = currentGamma;

  // We push the food away from the camera into the distance
  const distance = -800; 

  // Create the 3D position
  // We use translateZ to push it into the room and rotateY/X to place it in the specific spot you pointed at
  node.style.transform = `rotateY(${yRotation}deg) rotateX(${-xRotation}deg) translateZ(${distance}px)`;

  const img = document.createElement('img');
  img.src = selected.img;
  img.className = 'placed-dish';
  img.style.width = document.getElementById('sizeSlider').value + 'px';

  const shadow = document.createElement('div');
  shadow.className = 'dish-shadow';

  node.appendChild(img);
  node.appendChild(shadow);
  world.appendChild(node);

  if(navigator.vibrate) navigator.vibrate(15);
});
</script>
</body>
</html>
