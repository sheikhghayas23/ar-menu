<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Pro AR Spatial Menu v3.0</title>

<style>
  :root { --accent: #00ffcc; --ui-bg: rgba(0, 0, 0, 0.9); }
  body { margin: 0; overflow: hidden; font-family: -apple-system, system-ui, sans-serif; background: #000; color: #fff; }
  
  video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; }

  /* 3D Scene */
  #viewport { position: fixed; inset: 0; z-index: 2; perspective: 2000px; pointer-events: none; }
  #world { position: absolute; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.1s linear; }

  .spatial-anchor {
    position: absolute; left: 50%; top: 50%;
    transform-style: preserve-3d;
    display: flex; flex-direction: column; align-items: center;
  }

  .dish-plate {
    width: 280px; filter: drop-shadow(0 30px 50px rgba(0,0,0,0.9));
    animation: popScale 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    border-radius: 50%; border: 4px solid rgba(255,255,255,0.1);
  }

  @keyframes popScale {
    0% { transform: scale(0) translateZ(-500px); opacity: 0; }
    100% { transform: scale(1) translateZ(0); opacity: 1; }
  }

  /* Measurement HUD */
  #reticle {
    position: fixed; left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    width: 40px; height: 40px;
    border: 1.5px solid white; border-radius: 50%;
    z-index: 5; pointer-events: none;
    display: flex; align-items: center; justify-content: center;
  }
  #reticle::after { content: ''; width: 6px; height: 6px; background: var(--accent); border-radius: 50%; }

  /* UI Controls */
  #ui-panel {
    position: fixed; bottom: 0; width: 100%;
    background: linear-gradient(to top, #000 70%, transparent);
    z-index: 10; padding-bottom: env(safe-area-inset-bottom);
  }

  .carousel { display: flex; gap: 15px; overflow-x: auto; padding: 20px; scrollbar-width: none; }
  .carousel::-webkit-scrollbar { display: none; }

  .food-btn {
    min-width: 100px; padding: 15px; background: rgba(255,255,255,0.08);
    border-radius: 20px; border: 1px solid rgba(255,255,255,0.15);
    backdrop-filter: blur(15px); text-align: center; transition: 0.3s;
  }
  .food-btn.active { background: var(--accent); color: #000; border-color: #fff; transform: translateY(-5px); }

  .slider-box { padding: 0 25px; display: flex; align-items: center; gap: 15px; font-size: 11px; letter-spacing: 1px; }
  input[type=range] { flex: 1; accent-color: var(--accent); }

  #reset-btn {
    position: fixed; top: 20px; right: 20px; z-index: 11;
    background: rgba(255,50,50,0.8); border: none; padding: 10px 15px;
    border-radius: 12px; color: white; font-weight: bold; font-size: 12px;
  }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>
<button id="reset-btn" onclick="clearSpace()">RESET ROOM</button>
<div id="reticle"></div>

<div id="viewport">
  <div id="world"></div>
</div>

<div id="ui-panel">
  <div class="slider-box">
    <span>NEAR</span>
    <input type="range" id="distRange" min="500" max="1500" value="800">
    <span>FAR</span>
  </div>
  
  <div class="carousel" id="menu"></div>
  <div style="text-align:center; font-size:10px; color:rgba(255,255,255,0.4); margin-bottom:15px;">
    MOVE PHONE TO DIFFERENT SPOTS TO ARRANGE YOUR TABLE
  </div>
</div>

<script>
const menu = [
  { name: 'Biryani', img: 'https://media.istockphoto.com/id/501150349/photo/chicken-biryani-11.jpg?s=612x612&w=0&k=20&c=w6mDnUx8MnH3rnP9bR0VfWRwrODcbTz-6U07o3Zrs4o=' },
  { name: 'Pizza', img: 'https://img.freepik.com/free-psd/delicious-pepperoni-pizza-culinary-delight_632498-24206.jpg?w=740' },
  { name: 'Sushi', img: 'https://images.unsplash.com/photo-1579871494447-9811cf80d66c?q=80&w=500' },
  { name: 'Tacos', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTD-CUOhD5WqTgJIVDIjg40XOWKg4cf0rc56w&s' }
];

let selected = menu[0];
let currentA = 0, currentB = 0;
const world = document.getElementById('world');
const distInput = document.getElementById('distRange');

// Permissions & Camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(s => document.getElementById('camera').srcObject = s);

// Build Premium Menu
const menuCont = document.getElementById('menu');
menu.forEach((item, i) => {
  const btn = document.createElement('div');
  btn.className = `food-btn ${i === 0 ? 'active' : ''}`;
  btn.innerHTML = `<div>${item.name}</div>`;
  btn.onclick = (e) => {
    e.stopPropagation();
    document.querySelectorAll('.food-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selected = item;
    if(navigator.vibrate) navigator.vibrate(10);
  };
  menuCont.appendChild(btn);
});

// Spatial Tracking
window.addEventListener('deviceorientation', (e) => {
  currentA = e.alpha || 0;
  currentB = e.beta || 0;
  // Apply inverse rotation to the world container
  world.style.transform = `rotateX(${currentB - 90}deg) rotateZ(${-currentA}deg)`;
});

// Drop & Collision Logic
window.addEventListener('click', (e) => {
  if (e.target.closest('#ui-panel') || e.target.id === 'reset-btn') return;

  const anchor = document.createElement('div');
  anchor.className = 'spatial-anchor';

  // "PRO FEATURE": Randomize slightly to prevent perfect stacking
  const jitterA = (Math.random() - 0.5) * 5;
  const jitterB = (Math.random() - 0.5) * 5;
  
  const snapA = currentA + jitterA;
  const snapB = currentB + jitterB;
  const distance = distInput.value;

  // Complex 3D Transform: Points the anchor in the direction you are looking
  anchor.style.transform = `
    rotateZ(${snapA}deg) 
    rotateX(${-(snapB - 90)}deg) 
    translateZ(${distance}px)
  `;

  const img = document.createElement('img');
  img.src = selected.img;
  img.className = 'dish-plate';

  anchor.appendChild(img);
  world.appendChild(anchor);

  if(navigator.vibrate) navigator.vibrate([30, 10, 30]);
});

function clearSpace() {
  world.innerHTML = '';
}
</script>
</body>
</html>
