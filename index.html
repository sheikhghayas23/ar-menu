<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Pro AR Spatial Menu</title>

<style>
  body { margin: 0; overflow: hidden; font-family: 'SF Pro Display', -apple-system, sans-serif; background: #000; color: white; }
  
  /* Camera Layer */
  video { position: fixed; inset: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 1; }

  /* AR World Container - This holds the "pinned" food */
  #ar-world {
    position: fixed;
    inset: 0;
    z-index: 2;
    pointer-events: none;
    perspective: 1000px;
  }

  .placed-dish {
    position: absolute;
    width: 200px;
    transform-origin: center;
    transition: opacity 0.5s ease;
    filter: drop-shadow(0 20px 30px rgba(0,0,0,0.7));
  }

  /* Target Reticle (iPhone Measure Style) */
  #reticle {
    position: fixed;
    left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    width: 40px; height: 40px;
    border: 2px solid white;
    border-radius: 50%;
    z-index: 4;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #reticle::after { content: ''; width: 4px; height: 4px; background: white; border-radius: 50%; }

  /* UI Panel */
  #ui-overlay {
    position: fixed;
    bottom: 0; width: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.9) 80%, transparent);
    z-index: 5;
    padding-bottom: env(safe-area-inset-bottom);
  }

  .carousel { display: flex; gap: 12px; overflow-x: auto; padding: 15px; scrollbar-width: none; }
  .carousel::-webkit-scrollbar { display: none; }

  .food-card {
    min-width: 100px; padding: 12px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(15px);
    border-radius: 15px;
    border: 1px solid rgba(255,255,255,0.2);
    text-align: center;
    transition: transform 0.2s;
  }
  .food-card.selected { border-color: #00ffcc; background: rgba(0,255,204,0.1); }

  .instructions {
    text-align: center; font-size: 12px; color: #aaa;
    margin-top: 10px; text-transform: uppercase; letter-spacing: 1px;
  }

  #clear-btn {
    position: fixed; top: 20px; right: 20px;
    background: rgba(255,0,0,0.5); border: none; color: white;
    padding: 8px 15px; border-radius: 20px; z-index: 6;
  }
</style>
</head>
<body>

<video id="camera" autoplay playsinline></video>
<button id="clear-btn" onclick="clearDishes()">Clear All</button>

<div id="ar-world"></div>
<div id="reticle"></div>

<div id="ui-overlay">
  <div class="instructions">Point at a spot and tap the screen to place</div>
  <div class="carousel" id="menu">
    </div>
</div>

<script>
const menuData = [
  { id: 'biryani', name: 'Biryani', img: 'https://media.istockphoto.com/id/501150349/photo/chicken-biryani-11.jpg?s=612x612&w=0&k=20&c=w6mDnUx8MnH3rnP9bR0VfWRwrODcbTz-6U07o3Zrs4o=' },
  { id: 'pizza', name: 'Pizza', img: 'https://img.freepik.com/free-psd/delicious-pepperoni-pizza-culinary-delight_632498-24206.jpg?w=740' },
  { id: 'taco', name: 'Tacos', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTD-CUOhD5WqTgJIVDIjg40XOWKg4cf0rc56w&s' },
  { id: 'burger', name: 'Burger', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=500' }
];

let selectedFood = menuData[0];
const world = document.getElementById('ar-world');
let rotationX = 0, rotationY = 0;

// Setup Camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
  .then(stream => document.getElementById('camera').srcObject = stream);

// Create Menu
const menuContainer = document.getElementById('menu');
menuData.forEach(food => {
  const card = document.createElement('div');
  card.className = `food-card ${food.id === selectedFood.id ? 'selected' : ''}`;
  card.innerHTML = `<div style="font-size:20px">üçΩÔ∏è</div><div>${food.name}</div>`;
  card.onclick = (e) => {
    e.stopPropagation();
    document.querySelectorAll('.food-card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    selectedFood = food;
  };
  menuContainer.appendChild(card);
});

// Device Motion Logic (The "iPhone Measure" feel)
window.addEventListener('deviceorientation', (e) => {
  // We use the gamma (left/right) and beta (front/back) to move the world container
  // effectively keeping the "placed" items in the same spot in the room.
  rotationX = e.beta; 
  rotationY = e.gamma;
  
  // Apply the inverse rotation to the world so items stay "fixed" in space
  world.style.transform = `rotateX(${-rotationX}deg) rotateY(${-rotationY}deg)`;
});

// Place Dish Logic
window.addEventListener('click', (e) => {
  if (e.target.closest('#ui-overlay') || e.target.id === 'clear-btn') return;

  const newDish = document.createElement('img');
  newDish.src = selectedFood.img;
  newDish.className = 'placed-dish';
  
  // Calculate "World" position
  // We place it in the center, but adjusted by the current phone tilt 
  // so it stays where you were looking.
  const xPos = window.innerWidth / 2 - 100;
  const yPos = window.innerHeight / 2 - 100;
  
  newDish.style.left = `${xPos}px`;
  newDish.style.top = `${yPos}px`;
  
  // Give it a random slight rotation so multiple dishes don't look identical
  const randomRot = Math.random() * 20 - 10;
  newDish.style.transform = `translateZ(-500px) rotate(${randomRot}deg)`;

  world.appendChild(newDish);
});

function clearDishes() {
  world.innerHTML = '';
}
</script>
</body>
</html>
